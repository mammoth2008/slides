    <!doctype html>
    <html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=1024" />
        <meta name="apple-mobile-web-app-capable" content="yes" />

<!-- 修改页面标题 -->
        <title>DB & DS | HUST</title>

<!-- 修改 content -->
        <meta name="description" content="数据库与数据结构课程使用, 为哈尔滨理工大学经济管理学院信息管理与信息系统专业设计. " />
        <meta name="author" content="xinjiang@hrbust.edu.cn" />

<!-- 引入数学公式 -->
        <script type="text/javascript">
            window.MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
              },
              chtml: {
                scale: 0.95
              }
            };
        </script>
        <script src="../extras/mathjax/tex-chtml-full.js"></script>
<!-- 引入完毕 -->

        <link href="../css/impress-course.css" rel="stylesheet" />
        <link href="../css/impress-common.css" rel="stylesheet" />

        <link rel="shortcut icon" href="../hustlogo72.png" />
        <link rel="stylesheet" href="../extras/highlight/styles/github.css">

    </head>

    <body class="impress-not-supported">

<!-- 左上角加上 logo -->
    <div class="logo"></div>

    <div class="fallback-message">
        <p>你的浏览器不支持本网站所要求的功能, 现在看到的是本网站简化版本.</p>
        <p>为了获得最佳体验, 请使用最新的Chrome, Safari, Firefox 或 Edge 浏览器.</p>

    </div>

    <div 
    id                       = "impress" 
    data-transition-duration = "1000" 
    data-width               = "1024" 
    data-height              = "768" 
    data-max-scale           = "3" 
    data-min-scale           = "0" 
    data-perspective         = "1000" 
    data-autoplay            = "0">

<!-- 每一节 slide 的标题是 cxyt", 表示章节标题. 如第一章第一节标题就是 c11t, 第三章第二节标题就是 c32t -->
<!-- 每一节 slide 的标题页 class 应该是 step, 不是 step markdown -->
<!-- 类似地, 需要 HTML 排版的 slide,class 都是 step; 可以使用 markdown 的, class 才是 step markdown -->

    <div 
    id         = "overview" 
    data-x     = "0" 
    data-y     = "0" 
    class      = "step" 
    data-scale = "10">

    </div>

<!-- 修改 id -->

    <div 
    id         = "c63t"
    class      = "step"
    data-x     = "0"
    data-y     = "0"
    data-z     = "0"
    data-scale = "5">

    <!-- 修改标题 -->
        <h2>6. 数据库保护</h2>
        <h3 style="text-align: center">6.3 数据库恢复技术</h3>
        <p class="footnote">
            <inlinecode style="font-size: 16px">
            Powered by 
            </inlinecode>
                <a href="https://github.com/impress/impress.js/">
                    <inlinecode style="font-size: 16px">
                    impress.js
                    </inlinecode>
                    <img class="icon" src="../favicon.png" style="width:10px;height:10px;">
                </a>
                <br/>
                <inlinecode style="font-size: 16px">
                    Ver. 2408
                </inlinecode>
            </inlinecode>
        </p>

    </div>
        
    <div 
    id            = "a1"
    class         = "step markdown"
    data-rel-to   = "c63t"
    data-rel-x    = "-2000"
    data-rel-y    = "-2000"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 事务

- 用户定义的一个数据库操作序列
- 是不可分割的工作单位
- 以 BEGIN TRANSACTION 开始
- 以 COMMIT 或 ROLLBACK 结束

    </div>

    <div 
    id            = "a2"
    class         = "step markdown"
    data-rel-to   = "a1"
    data-rel-x    = "0"
    data-rel-y    = "1000"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 事务的 ACID 特性

- 原子性: 是数据库工作的最小单位
- 一致性: 从一个一致性状态变到另一个
- 隔离性: 执行不能被其他事务干扰
- 持久性: 对数据库的改变是永久的

    </div>

    <div 
    id            = "a3"
    class         = "step markdown"
    data-rel-to   = "a2"
    data-rel-x    = "0"
    data-rel-y    = "1000"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 数据库恢复

- 将数据库从错误状态恢复到正确状态的功能
- 数据库恢复的基本原理是冗余

    </div>

    <div 
    id            = "a4"
    class         = "step markdown"
    data-rel-to   = "a3"
    data-rel-x    = "0"
    data-rel-y    = "1000"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 故障的种类

- 事务内部故障
- 系统故障
- 介质故障
- 计算机病毒

    </div>

    <div 
    id            = "a5"
    class         = "step markdown"
    data-rel-to   = "a4"
    data-rel-x    = "0"
    data-rel-y    = "1200"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 事务内部故障

    BEGIN TRANSACTION
        BALANCE = BALANCE - AMOUNT;
        IF (BALANCE < 0 ) THEN
            {PRINT "INSUFFICIENT FUNDS";
            ROLLBACK;}
        ELSE
            {BALANCE1 = BALANCE1 + AMOUNT;
            COMMIT;}
- 当事务没有到达 COMMIT 或 ROLLBACK 语句时
- 意味着出现事务故障

    </div>

    <div 
    id            = "a6"
    class         = "step markdown"
    data-rel-to   = "a5"
    data-rel-x    = "0"
    data-rel-y    = "1200"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 系统故障

- 造成系统停止运转的事件
- 如硬件错误, 操作系统故障, DBMS代码错误等
- 影响所有正在运行的事务, 但不破坏数据库
- 需要在系统重新启动后撤销未完成的事务并重做已提交的事务

    </div>

    <div 
    id            = "a7"
    class         = "step markdown"
    data-rel-to   = "c63t"
    data-rel-x    = "0"
    data-rel-y    = "1000"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 介质故障

- 指外存故障
- 磁盘损坏, 磁头碰撞等
- 会破坏数据库
- 影响正在存取这部分数据的所有事务
- 需要将数据库从备份或日志中重建

    </div>

    <div 
    id            = "a8"
    class         = "step markdown"
    data-rel-to   = "a7"
    data-rel-x    = "0"
    data-rel-y    = "1000"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 计算机病毒

- 一种人为的故障或破坏
- 可以繁殖和传播
- 对计算机系统和数据库造成危害
- 使用病毒防护软件诊断和消除

    </div>

    <div 
    id            = "a9"
    class         = "step markdown"
    data-rel-to   = "a8"
    data-rel-x    = "0"
    data-rel-y    = "1000"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 总结

- 有些故障会破坏数据库本身
- 有些故障会导致数据不正确
- 数据库恢复需要在不影响其他事务运行的情况下, 将数据库恢复到正确状态

    </div>

    <div 
    id            = "a10"
    class         = "step markdown"
    data-rel-to   = "c63t"
    data-rel-x    = "2200"
    data-rel-y    = "-2000"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 恢复的实现技术

- 如何建立冗余数据
- 如何利用这些冗余数据实施数据库恢复

    </div>

    <div 
    id            = "a11"
    class         = "step markdown"
    data-rel-to   = "a10"
    data-rel-x    = "0"
    data-rel-y    = "700"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 数据转储

- DBA 定期将整个数据库复制到其他存储介质上保存
- 备用的数据称为后备副本 (backup) 或后援副本

    </div>

    <div 
    id            = "a12"
    class         = "step markdown"
    data-rel-to   = "a11"
    data-rel-x    = "0"
    data-rel-y    = "700"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 静态转储

- 在系统中无运行事务时进行的转储操作
- 简单, 但会降低数据库可用性

    </div>

    <div 
    id            = "a13"
    class         = "step markdown"
    data-rel-to   = "a12"
    data-rel-x    = "0"
    data-rel-y    = "700"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 动态转储

- 转储期间允许对数据库进行存取或修改
- 必须把转储期间各事务对数据库的修改登记下来
- 建立日志文件 (logfile)

    </div>

    <div 
    id            = "a14"
    class         = "step markdown"
    data-rel-to   = "a13"
    data-rel-x    = "0"
    data-rel-y    = "700"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 海量转储

- 每次转储全部数据库
- 恢复会更方便

    </div>

    <div 
    id            = "a15"
    class         = "step markdown"
    data-rel-to   = "a14"
    data-rel-x    = "0"
    data-rel-y    = "700"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 增量转储

- 每次只转储上一次转储后更新过的数据
- 更节省空间
- 通常更实用

    </div>

    <div 
    id            = "a16"
    class         = "step markdown"
    data-rel-to   = "a15"
    data-rel-x    = "0"
    data-rel-y    = "700"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 日志文件

- 用来记录事务对数据库的更新操作的文件
- 以记录为单位
- 以数据块为单位

    </div>

    <div 
    id            = "a17"
    class         = "step markdown"
    data-rel-to   = "a16"
    data-rel-x    = "0"
    data-rel-y    = "800"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 以记录为单位

- 各个事务的开始 (BEGIN TRANSACTION) 标记
- 各个事务的结束 (COMMIT 或 ROLLBACK) 标记
- 各个事务的所有更新操作
- 被称作日志记录 (log record)

    </div>

    <div 
    id            = "a18"
    class         = "step markdown"
    data-rel-to   = "c63t"
    data-rel-x    = "3900"
    data-rel-y    = "1000"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 日志记录的内容

- 事务标识 (标明是哪个事务)
- 操作的类型 (插入, 删除或修改)
- 操作对象 (记录内部标识)
- 更新前数据的旧值 (对插入操作而言, 此项为空值)
- 更新后数据的新值 (对删除操作而言, 此项为空值)

    </div>

    <div 
    id            = "a19"
    class         = "step markdown"
    data-rel-to   = "a18"
    data-rel-x    = "0"
    data-rel-y    = "800"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 以数据块为单位

- 事务标识
- 被更新的数据块

    </div>

    <div 
    id            = "a20"
    class         = "step markdown"
    data-rel-to   = "a19"
    data-rel-x    = "0"
    data-rel-y    = "800"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 日志文件的作用

- 事务故障恢复和系统故障恢复必须用日志文件
- 在动态转储方式中必须建立日志文件
- 在静态转储方式中也可以建立日志文件

    </div>

    <div 
    id            = "a21"
    class         = "step markdown"
    data-rel-to   = "a20"
    data-rel-x    = "0"
    data-rel-y    = "700"
    data-rel-z    = "0"
    data-rotate-y = "0"
    data-scale    = "2">

### 登记日志文件的原则

- 登记的次序严格按并发事务执行的时间次序
- 先写日志文件, 后写数据库

    </div>

    <div
    id            = "mm63"
    class         = "step markdown"
    data-rel-to   = "c63t"
    data-rel-x    = "0"
    data-rel-y    = "-2000"
    data-rotate-y = "0"
    data-rotate   = "0"
    data-scale    = "1">

![course 6.3 mindmap](img/c06/mindmap-6-3.png)

    </div>

<!-- 本节问题 -->

    <div
    id            = "c63q"
    class         = "step markdown"
    data-rel-to   = "c63t"
    data-rel-x    = "0"
    data-rel-y    = "-800"
    data-z        = "500"
    data-rotate-x = "77"
    data-rotate-y = "0"
    data-rotate-z = "180"
    data-scale    = "2">

### 6.3 数据库恢复技术

- 什么是事务?
- 请解释事务的 ACID 特性.
- 数据库恢复的基本原理是什么?
- 系统故障和介质故障有何不同?
- 什么是数据转储?
- 什么是日志文件?

----

[ 6.2 数据库完整性](dbds-6-2.html#/overview)
[| 练习 |](dbds-exec.html)
[ 6.4 数据库并发控制](dbds-6-4.html#/overview)

    </div>

    </div>

    <!--
    <div id="impress-toolbar"></div>
    <div id="impress-help"></div>

    <script>
    if ("ontouchstart" in document.documentElement) { 
        document.querySelector(".hint").innerHTML = "<p>Swipe left or right to navigate</p>";
    }
    </script>
    -->

    <!-- 页面下方显示进度条 -->
    <div class="impress-progressbar">
        <div></div>
    </div>

    <!-- 页面下方显示当前页/总页数 -->
    <div class="impress-progress"></div>

    <!-- 使用 markdown 写简单页面 -->
    <script type="text/javascript" src="../extras/markdown/markdown.js"></script>

    <!-- 语法高亮,配合<head>中的 highlight css 起作用 -->
    <script src="../extras/highlight/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

    <!-- impress.js 需要放在最下面,并且初始化 -->
    <script src="../js/impress.js"></script>
    <script>impress().init();</script>
    </body>
    </html>
